<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMG - Prospecção Inteligente</title>
    <link rel="stylesheet" href="prospeccao.css?v=1.0.0.0">
    <link rel="stylesheet" href="social-media-styles.css?v=1.0.0.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="logo.png" alt="Logo da Empresa" class="company-logo" crossorigin="anonymous">
                <h1>Prospecção Inteligente</h1>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="form-section">
            <div class="card">
                <h2><i class="fas fa-search"></i> Dados do Cliente</h2>
                <form id="prospectForm">
                    <div class="form-group">
                        <label for="cnpj">CNPJ:</label>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="cnpj" placeholder="00.000.000/0001-00" required style="flex: 1; min-width: 200px;">
                            <button type="button" id="searchCnpj" class="btn btn-secondary">
                                <i class="fas fa-search"></i> Buscar API
                            </button>
                            <button type="button" id="searchClients" class="btn btn-primary" style="background: #28a745;">
                                <i class="fas fa-users"></i> Buscar Clientes
                            </button>
                        </div>
                        <small>Digite o CNPJ ou use "Buscar Clientes" para ver lista de clientes ativos/inativos. O enriquecimento de dados será feito automaticamente.</small>
                    </div>

                    <!-- Modal para seleção de clientes -->
                    <div id="clientModal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                            <div class="modal-header">
                                <h2><i class="fas fa-users"></i> Selecionar Cliente</h2>
                                <span class="close" id="closeClientModal">&times;</span>
                            </div>
                            <div style="padding: 20px; overflow-y: auto; max-height: 60vh;">
                                <div style="margin-bottom: 15px;">
                                    <input type="text" id="clientSearch" placeholder="Buscar por nome ou CNPJ..." 
                                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                </div>
                                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                    <button type="button" id="showActiveClients" class="btn btn-success filter-btn" data-filter="active">
                                        <i class="fas fa-check-circle"></i> Ativos
                                    </button>
                                    <button type="button" id="showInactiveClients" class="btn btn-secondary filter-btn" data-filter="inactive">
                                        <i class="fas fa-pause-circle"></i> Inativos
                                    </button>
                                </div>
                                <div id="clientList" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Lista de clientes será carregada aqui -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="keywords">Palavras-chave do Cardápio:</label>
                        <textarea id="keywords" placeholder="Digite palavras-chave do cardápio separadas por vírgula (ex: pizza, hambúrguer, refrigerante, açaí, carne, frango, batata frita, sorvete)" 
                                  rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; resize: vertical; font-family: inherit;"></textarea>
                        <small>Digite palavras-chave que descrevem o cardápio do cliente para sugestões mais precisas</small>
                        <div style="margin-top: 10px;">
                            <strong>💡 Clique nos segmentos para adicionar insumos automaticamente:</strong>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 6px; margin-top: 8px;">
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pizza, mussarela, molho de tomate, farinha, fermento, oregano, azeitona, calabresa, presunto, queijo'">🍕 Pizzaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carne bovina, frango, peixe, arroz, feijão, óleo, temperos, legumes, verduras, batata, cebola'">🍽️ Restaurante</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pão hambúrguer, carne, frango, batata frita, refrigerante, maionese, ketchup, mostarda, alface, tomate'">🍔 Lanchonete</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'farinha trigo, fermento, açúcar, ovos, leite, manteiga, sal, chocolate, frutas, recheios'">🥖 Padaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carnes, frios, laticínios, bebidas, enlatados, congelados, higiene, limpeza, hortifruti, cereais'">🛒 Supermercado</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'massa pastel, óleo fritura, queijo, presunto, carne moída, palmito, catupiry, molhos'">🥟 Pastelaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'cerveja, bebidas alcoólicas, refrigerantes, petiscos, amendoim, azeitona, queijos, carnes frias'">🍺 Bar/Choperia</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'arroz, feijão, açúcar, óleo, enlatados, massas, temperos, produtos limpeza, bebidas'">� Mercearia</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carnes, aves, peixes, frutos mar, temperos, sal grosso, embalagens, papel filme, luvas'">🏨 Hotel/Pousada</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'massa esfiha, carne, cebola, tomate, temperos árabes, queijo, ricota, espinafre'">🥙 Esfiharia</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'shoyu, missô, nori, wasabi, gengibre, sake, arroz sushi, salmão, atum, pepino japonês'">🍱 Cozinha Oriental</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'ingredientes grande escala, carnes, verduras, temperos, óleo, arroz, feijão, massas, conservas'">🏭 Cozinha Industrial</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carne bovina, linguiça, frango, sal grosso, carvão, farofa, vinagrete, pão alho'">🔥 Churrascaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'farinha trigo, ovos, semolina, massa fresca, molhos, queijos, azeite, ervas'">� Fábrica Massas</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'açúcar, chocolate, farinha, ovos, leite, creme leite, frutas, essências, corantes, confeitos'">🧁 Confeitaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'leite, queijos, iogurte, manteiga, creme leite, requeijão, embalagens, conservantes'">🧀 Laticínios</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'refrigerantes, sucos, água, snacks, salgadinhos, doces, cigarros, produtos conveniência'">🏪 Loja Conveniência</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carnes bovinas, suínas, aves, peixes, temperos, sal, embalagens, papel, luvas descartáveis'">🥩 Açougue</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'frango assado, temperos, óleo, batata, polenta, farofa, molhos, embalagens'">🍗 Rotisserie</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'vinhos, espumantes, cervejas especiais, queijos, embutidos, petiscos gourmet, taças'">🍷 Adega</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'ingredientes eventos, carnes, saladas, bebidas, descartáveis, decoração comestível'">🏛️ Clube/Associação</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pratos prontos, saladas, carnes, acompanhamentos, sobremesas, bebidas, descartáveis'">�️ Buffet</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pão hambúrguer, carne, bacon, queijo, alface, tomate, batata, molhos, refrigerantes'">🍔 Hamburgueria</span>
                            </div>
                        </div>
                    </div>

                    <!-- 📱 SEÇÃO DE REDES SOCIAIS MANUAIS -->
                    <div class="form-group">
                        <label><i class="fab fa-instagram"></i> Redes Sociais do Cliente:</label>
                        
                        <!-- Formulário para adicionar rede social -->
                        <div class="social-media-form" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e9ecef;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                                <div>
                                    <label for="socialPlatform" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Rede Social</label>
                                    <select id="socialPlatform" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                        <option value="">Selecione...</option>
                                        <option value="Instagram">📷 Instagram</option>
                                        <option value="Facebook">👥 Facebook</option>
                                        <option value="WhatsApp Business">💬 WhatsApp Business</option>
                                        <option value="TikTok">🎵 TikTok</option>
                                        <option value="YouTube">📺 YouTube</option>
                                        <option value="LinkedIn">💼 LinkedIn</option>
                                        <option value="Twitter">🐦 Twitter/X</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="socialPublications" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Publicações</label>
                                    <input type="number" id="socialPublications" placeholder="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
                                    <label for="socialFollowers" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Seguidores</label>
                                    <input type="number" id="socialFollowers" placeholder="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
                                    <label for="socialFollowing" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Seguindo</label>
                                    <input type="number" id="socialFollowing" placeholder="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
                                    <button type="button" id="addSocialMedia" class="btn btn-success" style="padding: 8px 16px; font-size: 14px; white-space: nowrap;">
                                        <i class="fas fa-plus"></i> Cadastrar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lista de redes sociais cadastradas -->
                        <div id="socialMediaList" class="social-media-list" style="margin-top: 15px;">
                            <!-- Redes sociais cadastradas aparecerão aqui -->
                        </div>
                        
                        <small class="text-muted">
                            📝 <strong>Dica:</strong> Adicione as redes sociais do cliente para uma análise mais precisa. 
                            Demografia e oportunidade serão calculadas automaticamente baseadas no CNPJ e redes sociais.
                        </small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Analisar e Criar Prospecção
                    </button>
                </form>
            </div>

            <!-- 📱 SEÇÃO DE ANÁLISE DE REDES SOCIAIS - SEMPRE VISÍVEL -->
            <div id="socialAnalysisSection" class="social-analysis-section card" style="display: block !important; visibility: visible !important; opacity: 1 !important; margin-bottom: 2rem;">
                <h2><i class="fab fa-instagram"></i> Análise de Redes Sociais</h2>
                
                <!-- 🖼️ ÁREA PARA COLAR IMAGEM -->
                <div class="form-group">
                    <label>� Cole uma imagem da rede social (Ctrl+V):</label>
                    <div id="imageDropZone" class="image-drop-zone" style="border: 3px dashed #ddd; border-radius: 10px; padding: 40px; text-align: center; background: #f8f9fa; margin: 15px 0; min-height: 200px; position: relative; cursor: pointer;">
                        <div id="dropZoneContent">
                            <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #6c757d; margin-bottom: 15px;"></i>
                            <p style="font-size: 18px; color: #6c757d; margin: 10px 0;">
                                <strong>Cole uma imagem aqui (Ctrl+V)</strong><br>
                                ou clique para selecionar arquivo
                            </p>
                            <small style="color: #888;">
                                Formatos aceitos: PNG, JPG, JPEG<br>
                                Screenshots de Instagram, Facebook, WhatsApp Business, etc.
                            </small>
                        </div>
                        <input type="file" id="imageFileInput" accept="image/*" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer;">
                        <canvas id="previewCanvas" style="display: none; max-width: 100%; max-height: 300px; border: 2px solid #007bff; border-radius: 5px; margin-top: 15px;"></canvas>
                    </div>
                    
                    <!-- 🎯 BOTÕES DE ANÁLISE -->
                    <div class="analysis-buttons" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                        <button type="button" id="analyzeImageBtn" class="btn btn-primary" style="background: linear-gradient(135deg, #28a745, #20c997); padding: 12px 20px;" disabled onclick="analyzeImageData()">
                            <i class="fas fa-search"></i> Analisar Imagem
                        </button>
                        <button type="button" id="clearImageBtn" class="btn btn-secondary" style="padding: 12px 20px;" onclick="clearImageAnalysis()">
                            <i class="fas fa-trash"></i> Limpar
                        </button>
                    </div>
                    
                    <!-- 📊 RESULTADOS DA ANÁLISE -->
                    <div id="imageAnalysisResults" class="analysis-results" style="display: none; margin-top: 20px; padding: 20px; background: #e8f5e8; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h4><i class="fas fa-chart-line"></i> Análise da Rede Social</h4>
                        <div id="analysisData"></div>
                    </div>
                    
            <div class="loading-section" id="loadingSection" style="display: none;">
                <div class="card">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <h3>Analisando dados do cliente... </h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="loading-steps">
                        <div class="step" id="step1">
                            <i class="fas fa-building"></i> Coletando dados da empresa
                        </div>
                        <div class="step" id="step2">
                            <i class="fas fa-map-marker-alt"></i> Analisando localização
                        </div>
                        <div class="step" id="step3">
                            <i class="fas fa-utensils"></i> Processando cardápio
                        </div>
                        <div class="step" id="step4">
                            <i class="fas fa-chart-line"></i> Sugerindo produtos
                        </div>
                        <div class="step" id="step5">
                            <i class="fas fa-palette"></i> Criando arte personalizada
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="company-info card">
                <h2><i class="fas fa-building"></i> Informações da Empresa</h2>
                <div id="companyDetails"></div>
            </div>

            <div class="sales-script card">
                <h2><i class="fas fa-microphone"></i> Script de Vendas Personalizado</h2>
                <div id="salesScript"></div>
                <button id="copySalesScript" class="btn btn-secondary">
                    <i class="fas fa-copy"></i> Copiar Script
                </button>
            </div>
            

            <div class="product-suggestions card">
                <h2><i class="fas fa-lightbulb"></i> Produtos Sugeridos</h2>
                
                <div id="productSuggestions"></div>
                <div class="offer-actions" style="display: flex; gap: 10px; margin-top: 15px; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <button id="copyOfferText" class="btn btn-primary">
                        <i class="fas fa-copy"></i> Copiar Texto
                    </button>
                    <button id="copyOfferImage" class="btn btn-success">
                        <i class="fas fa-image"></i> Copiar Imagem
                    </button>
                    
                    <!-- ✅ SELETOR DE FAIXA DE PREÇO -->
                    <label for="price-band-select-prosp" style="margin-left: 20px; font-weight: 500; color: #333;">Faixa de preço:</label>
                    <select id="price-band-select-prosp" class="btn btn-secondary" style="min-width: 160px; height: 38px; border: 1px solid #ddd; border-radius: 4px; padding: 0 8px;">
                        <option value="retira">Retira R$</option>
                        <option value="entrega">Entrega R$</option>
                        <option value="km100_199">100 a 199 km</option>
                        <option value="km200_299">200 a 299 km</option>
                        <option value="km300_399">300 a 399 km</option>
                        <option value="km400_499">400 a 499 km</option>
                        <option value="km500_599">500 a 599 km</option>
                        <option value="km600_plus">Acima 600km</option>
                    </select>
                    
                    <!-- Controle de fundo dinâmico ao lado dos botões -->
                    <label style="display:inline-flex; align-items:center; gap:6px; margin-left: 15px; font-weight: 500; color: #333;">
                        <input type="checkbox" id="toggle-dynamic-bg-prosp"> Fundo dinâmico
                    </label>
                </div>
            </div>

            
        </div>
    </div>

    <!-- Modal para Arte da Oferta -->
<div id="offerModal" class="offer-customized card" style="display: none;">
    <div class="modal-header">
        <h2><i class="fas fa-palette"></i> Arte da Oferta Personalizada</h2>
        <span class="close-btn" id="closeModal">&times;</span>
    </div>
    <div class="offer-customized-content">
        <div class="offer-preview" id="offerPreview">
            <!-- Arte será gerada aqui -->
            <p>PMG 30 Anos</p>
            <h3>Oferta Especial<br>Personalizada para <span id="clientName">NOME DA EMPRESA</span></h3>
            <div class="offer-products" id="dynamicOfferProducts">
                <!-- Produtos escolhidos pelo usuário serão inseridos aqui dinamicamente -->
            </div>
        </div>
    </div>
    <div class="modal-buttons" style="margin-top: 20px; text-align: center;">
    <button id="copyOfferImage" class="btn-primary" style="margin-right: 10px; background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        📋 Copiar Imagem
    </button>
    <button id="copyOfferText" class="btn-secondary" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        📄 Copiar Texto
    </button>
</div>
</div>

    <script src="prospeccao.js?v=1.0.0.0"></script>
    <script src="image-analyzer.js?v=1.0.0"></script>
    <script src="cnpj-api.js?v=1.0.0.0"></script>
    <script src="enriquecimento-dados.js?v=1.0.0.0"></script>
    <script>
        // Sincroniza valor inicial do seletor com localStorage, caso o JS principal demore
        (function(){
            try {
                var band = localStorage.getItem('priceBand') || 'retira';
                var sel = document.getElementById('price-band-select-pros');
                if (sel) sel.value = band;
            } catch(e) {}
        })();
        
        // Testar se o picture-in-picture foi carregado
        window.addEventListener('load', function() {
            console.log('� Verificando carregamento do sistema...');
            console.log('📋 Todas as variáveis window:', Object.keys(window).filter(k => k.includes('social') || k.includes('Social') || k.includes('analyzer') || k.includes('Analyzer') || k.includes('PIP') || k.includes('pip')));
            
            // Verificar múltiplas formas da variável
            const pip1 = window.socialMediaAnalyzerPIP;
            const pip2 = window['socialMediaAnalyzerPIP'];
            const pip3 = typeof socialMediaAnalyzerPIP !== 'undefined' ? socialMediaAnalyzerPIP : null;
            
            console.log('📱 Picture-in-Picture verificações:', {
                'window.socialMediaAnalyzerPIP': !!pip1,
                'window["socialMediaAnalyzerPIP"]': !!pip2,
                'socialMediaAnalyzerPIP global': !!pip3,
                'SocialMediaAnalyzer class': typeof SocialMediaAnalyzer
            });
            
            const finalPIP = pip1 || pip2 || pip3;
            
            if (finalPIP) {
                console.log('✅ Social Media Analyzer Picture-in-Picture carregado com sucesso!');
                // Disponibilizar globalmente se não estiver
                if (!window.socialMediaAnalyzerPIP) {
                    window.socialMediaAnalyzerPIP = finalPIP;
                }
            } else {
                console.error('❌ Social Media Analyzer Picture-in-Picture não foi carregado');
                
                // Tentar criar uma instância se a classe estiver disponível
                if (typeof SocialMediaAnalyzer !== 'undefined') {
                    try {
                        console.log('🔄 Tentando criar instância manualmente...');
                        window.socialMediaAnalyzerPIP = new SocialMediaAnalyzer();
                        console.log('✅ Instância criada manualmente com sucesso!');
                    } catch (error) {
                        console.error('❌ Erro ao criar instância manualmente:', error);
                    }
                } else {
                    console.error('❌ Classe SocialMediaAnalyzer não está disponível');
                }
            }
            
            // Garantir que a seção de análise social esteja visível
            const socialSection = document.getElementById('socialAnalysisSection');
            if (socialSection) {
                socialSection.style.display = 'block';
                socialSection.style.visibility = 'visible';
                socialSection.style.opacity = '1';
                console.log('✅ Seção de análise social está visível');
                
                // Verificar se tem conteúdo
                const hasContent = socialSection.innerHTML.trim().length > 0;
                console.log('📋 Seção tem conteúdo:', hasContent);
                console.log('📏 Tamanho do conteúdo:', socialSection.innerHTML.length);
                
                // Verificar se está sendo ocultada por CSS
                const computedStyle = window.getComputedStyle(socialSection);
                console.log('👁️ Display:', computedStyle.display);
                console.log('👁️ Visibility:', computedStyle.visibility);
                console.log('👁️ Opacity:', computedStyle.opacity);
                
            } else {
                console.error('❌ Seção socialAnalysisSection não encontrada');
                
                // Tentar criar a seção se ela não existir
                const formSection = document.querySelector('.form-section');
                if (formSection) {
                    const socialDiv = document.createElement('div');
                    socialDiv.id = 'socialAnalysisSection';
                    socialDiv.className = 'social-analysis-section card';
                    socialDiv.style.cssText = 'display: block !important; visibility: visible !important; opacity: 1 !important; margin-bottom: 2rem; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);';
                    socialDiv.innerHTML = `
                        <h2><i class="fab fa-instagram"></i> Análise de Redes Sociais</h2>
                        <div class="form-group">
                            <label>📸 Instagram do Cliente:</label>
                            <div class="input-group" style="display: flex; gap: 10px; align-items: center; margin: 15px 0;">
                                <input type="url" id="instagramUrl" placeholder="https://www.instagram.com/cliente" style="flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 5px; font-size: 16px;">
                                <button type="button" class="btn btn-primary" style="padding: 12px 20px; background: linear-gradient(135deg, #833ab4, #fd1d1d, #fcb045); color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;" onclick="if(window.socialMediaAnalyzerPIP) { const url = document.getElementById('instagramUrl').value; if(url) socialMediaAnalyzerPIP.analyzeInstagram(url); else alert('Digite a URL do Instagram'); } else alert('Sistema carregando...')">
                                    📱 Picture-in-Picture
                                </button>
                            </div>
                            <small class="text-muted">Digite a URL do perfil do Instagram e use o modo picture-in-picture para navegação natural</small>
                        </div>
                    `;
                    
                    // Inserir após o primeiro card
                    const firstCard = formSection.querySelector('.card');
                    if (firstCard) {
                        firstCard.insertAdjacentElement('afterend', socialDiv);
                        console.log('✅ Seção de análise social criada dinamicamente');
                    }
                }
            }
        });
        
        // Função para testar picture-in-picture
        function testPictureInPicture() {
            console.log('🎯 Botão Picture-in-Picture clicado');
            
            const url = document.getElementById('instagramUrl').value;
            if (!url) {
                alert('❌ Digite a URL do Instagram primeiro!');
                return;
            }
            
            // Verificar múltiplas formas de acessar o analyzer
            const analyzer = window.socialMediaAnalyzerPIP || 
                           window['socialMediaAnalyzerPIP'] || 
                           (typeof socialMediaAnalyzerPIP !== 'undefined' ? socialMediaAnalyzerPIP : null);
            
            if (analyzer) {
                console.log('✅ Analyzer encontrado, iniciando análise...');
                try {
                    const result = analyzer.analyzeInstagram(url);
                    console.log('📊 Resultado:', result);
                } catch (error) {
                    console.error('❌ Erro na análise:', error);
                    alert('❌ Erro ao executar análise: ' + error.message);
                }
            } else {
                console.error('❌ Analyzer não encontrado');
                alert('❌ Sistema Picture-in-Picture não carregado. Verifique o console para mais detalhes.');
                
                // Tentar carregar manualmente
                if (typeof SocialMediaAnalyzer !== 'undefined') {
                    try {
                        console.log('🔄 Criando analyzer manualmente...');
                        const manualAnalyzer = new SocialMediaAnalyzer();
                        window.socialMediaAnalyzerPIP = manualAnalyzer;
                        manualAnalyzer.analyzeInstagram(url);
                    } catch (error) {
                        console.error('❌ Erro ao criar manualmente:', error);
                    }
                }
            }
        }
    </script>
</body>
</html>
