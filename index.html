<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä Prospec√ß√£o de Clientes Inativos</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
    <h1>üìä Prospec√ß√£o de Clientes Inativos</h1>
    
    <div id="upload">
        <input type="file" id="xlsxFile" accept=".xlsx,.xls">
        <label for="xlsxFile">üìÅ Carregar Planilha (.xlsx)</label>
        <button id="cadastrar-cliente-btn">‚ûï Cadastrar Cliente</button>
    </div>

    <div id="tabs">
        <button class="active" onclick="openTab('inativos')">Inativos</button>
        <button onclick="openTab('ativos')">Ativos</button>
        <button onclick="openTab('agenda')">Agenda</button>
        <button onclick="openTab('mapa')">Mapa</button>
        <button onclick="openTab('catalogo')">Cat√°logo</button>
    </div>

    <div id="inativos-content" class="tab-content active">
        <div id="filters">
            <input type="number" id="saldoFilter" placeholder="Saldo m√≠nimo" min="0" step="0.01">
            <select id="sortOption">
                <option value="nome-az">Nome Fantasia (A-Z)</option>
                <option value="nome-za">Nome Fantasia (Z-A)</option>
                <option value="saldo-desc">Saldo de Cr√©dito (Maior-Menor)</option>
                <option value="saldo-asc">Saldo de Cr√©dito (Menor-Maior)</option>
                <option value="data-asc">Data √öltimo Pedido (Antigo-Recente)</option>
                <option value="data-desc">Data √öltimo Pedido (Recente-Antigo)</option>
            </select>
            <div id="cidadeSelector">
                <span id="cidadeSelectorText">Selecionar cidades</span>
                <span class="seta">‚ñº</span>
            </div>
            <div id="cidadeList" class="escondido"></div>
        </div>
        <ul id="list"></ul>
        <button id="exportar-inativos" class="export-btn">üìä Exportar Inativos</button>
    </div>

    <div id="ativos-content" class="tab-content">
        <ul id="ativos-list"></ul>
        <button id="exportar-ativos" class="export-btn">üìä Exportar Ativos</button>
    </div>

    <div id="agenda-content" class="tab-content">
        <div id="agenda-list"></div>
    </div>

    <div id="mapa-content" class="tab-content">
        <div id="mapa-controls">
            <button id="edit-mode-btn" class="map-control-btn">‚úèÔ∏è Editar Localiza√ß√µes</button>
            <label class="checkbox-container">
                <input type="checkbox" id="include-inativos-checkbox">
                <span>Incluir inativos</span>
            </label>
        </div>
        <div id="map-status">Carregando mapa...</div>
        <div id="map" style="height: 500px;"></div>
    </div>

    <div id="catalogo-content" class="tab-content">
        <div id="catalog-controls">
            <input type="text" id="product-search" placeholder="Buscar produtos...">
            <button id="refresh-catalog" class="catalog-btn">üîÑ Atualizar Cat√°logo</button>
            <button id="select-multiple-products" class="catalog-btn">üìã Selecionar M√∫ltiplos</button>
        </div>
        <div id="catalog-status">Carregando cat√°logo...</div>
        <div id="products-grid"></div>
    </div>

    <!-- Modal de detalhes -->
    <div id="modal" class="modal">
        <div id="modal-content" class="modal-content">
            <span id="close" class="close">&times;</span>
            <div id="item-details"></div>
            
            <div id="modal-actions">
                <button id="whatsapp-btn">üì± WhatsApp</button>
                <button id="maps-btn">üó∫Ô∏è Tra√ßar Rota</button>
            </div>

            <!-- Se√ß√£o de Agendamento -->
            <div id="schedule-section" style="margin-top: 20px;">
                <h3>Agendamento</h3>
                <label>
                    Dia da Semana:
                    <select id="scheduleDayOfWeek">
                        <option value="">Selecione</option>
                        <option value="0">Domingo</option>
                        <option value="1">Segunda</option>
                        <option value="2">Ter√ßa</option>
                        <option value="3">Quarta</option>
                        <option value="4">Quinta</option>
                        <option value="5">Sexta</option>
                        <option value="6">S√°bado</option>
                    </select>
                </label>
                <label>
                    Hor√°rio:
                    <input type="time" id="scheduleTime">
                </label>
                <label>
                    Tipo:
                    <select id="scheduleType">
                        <option value="">Selecione</option>
                        <option value="visita">Visita</option>
                        <option value="ligacao">Liga√ß√£o</option>
                        <option value="whatsapp">WhatsApp</option>
                    </select>
                </label>
                <label>
                    Repeti√ß√£o:
                    <select id="scheduleRepeat">
                        <option value="weekly">Semanal</option>
                        <option value="biweekly">Quinzenal</option>
                        <option value="monthly">Mensal</option>
                    </select>
                </label>
                <button id="saveSchedule">Salvar agendamento</button>
            </div>

            <!-- A√ß√µes espec√≠ficas para ativos/inativos -->
            <div id="client-actions" style="margin-top: 20px;">
                <div class="display-field">
                    <p><strong>Status:</strong> <span id="client-status">Inativo</span></p>
                </div>
                
                <div id="editDataPedidoContainer" style="display: none;">
                    <label id="labelEditDataPedido" style="display: none;">
                        Data √öltimo Pedido:
                        <input type="text" id="editDataPedido" placeholder="dd/mm/aaaa" maxlength="10" style="display: none;">
                    </label>
                </div>
                
                <div class="action-buttons">
                    <button id="tornarAtivo" class="action-btn edit-btn">Tornar Ativo</button>
                    <button id="confirmarAtivo" class="action-btn save-btn" style="display: none;">Confirmar Ativo</button>
                    <button id="excluirAtivo" class="action-btn cancel-btn" style="display: none;">Excluir dos Ativos</button>
                </div>
            </div>

            <!-- Se√ß√£o de Observa√ß√µes -->
            <div style="margin-top: 20px;">
                <h3>Observa√ß√µes</h3>
                <textarea id="observacoes" placeholder="Adicione observa√ß√µes sobre este cliente..."></textarea>
                <div id="observacoes-contador">0/2000</div>
                <button id="salvarObservacoes">Salvar Observa√ß√µes</button>
            </div>

            <!-- Se√ß√£o de Edi√ß√£o -->
            <div style="margin-top: 20px;">
                <button id="editarCliente" class="action-btn edit-btn">Editar Cliente</button>
                <button id="salvarEdicao" class="action-btn save-btn" style="display: none;">üíæ Salvar</button>
                <button id="cancelarEdicao" class="action-btn cancel-btn" style="display: none;">‚ùå Cancelar</button>
            </div>

            <!-- Campos de edi√ß√£o (ocultos inicialmente) -->
            <div class="edit-field" style="display: none;">
                <label>Nome Fantasia:</label>
                <input type="text" id="edit-nome-fantasia" class="edit-input">
                
                <label>Cliente:</label>
                <input type="text" id="edit-cliente" class="edit-input">
                
                <label>CNPJ/CPF:</label>
                <input type="text" id="edit-cnpj-cpf" class="edit-input">
                
                <label>Contato:</label>
                <input type="text" id="edit-contato" class="edit-input">
                
                <label>Telefone Comercial:</label>
                <input type="text" id="edit-telefone-comercial" class="edit-input">
                
                <label>Celular:</label>
                <input type="text" id="edit-celular" class="edit-input">
                
                <label>Email:</label>
                <input type="email" id="edit-email" class="edit-input">
                
                <label>Endere√ßo:</label>
                <input type="text" id="edit-endereco" class="edit-input">
                
                <label>N√∫mero:</label>
                <input type="text" id="edit-numero" class="edit-input">
                
                <label>Bairro:</label>
                <input type="text" id="edit-bairro" class="edit-input">
                
                <label>Cidade:</label>
                <input type="text" id="edit-cidade" class="edit-input">
                
                <label>UF:</label>
                <input type="text" id="edit-uf" class="edit-input" maxlength="2">
                
                <label>CEP:</label>
                <input type="text" id="edit-cep" class="edit-input">
                
                <label>Saldo de Cr√©dito:</label>
                <input type="number" id="edit-saldo-credito" class="edit-input" step="0.01">
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro -->
    <div id="modal-cadastro" class="modal">
        <div id="modal-cadastro-content" class="modal-content">
            <span id="close-cadastro" class="close">&times;</span>
            <h2>Cadastrar Novo Cliente</h2>
            
            <form id="form-cadastro">
                <label for="nome-fantasia">Nome Fantasia:</label>
                <input type="text" id="nome-fantasia" required>
                
                <label for="cliente">Cliente:</label>
                <input type="text" id="cliente">
                
                <label for="cnpj-cpf">CNPJ/CPF:</label>
                <input type="text" id="cnpj-cpf">
                
                <label for="contato">Contato:</label>
                <input type="text" id="contato">
                
                <label for="telefone-comercial">Telefone Comercial:</label>
                <input type="tel" id="telefone-comercial">
                
                <label for="celular">Celular:</label>
                <input type="tel" id="celular">
                
                <label for="email">Email:</label>
                <input type="email" id="email">
                
                <label for="endereco">Endere√ßo:</label>
                <input type="text" id="endereco">
                
                <label for="numero">N√∫mero:</label>
                <input type="text" id="numero">
                
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro">
                
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade">
                
                <label for="uf">UF:</label>
                <input type="text" id="uf" maxlength="2">
                
                <label for="cep">CEP:</label>
                <input type="text" id="cep">
                
                <label for="saldo-credito">Saldo de Cr√©dito:</label>
                <input type="number" id="saldo-credito" step="0.01" value="0">
                
                <label for="data-ultimo-pedido">Data √öltimo Pedido:</label>
                <input type="date" id="data-ultimo-pedido">
                
                <div class="form-actions">
                    <button type="submit">Cadastrar</button>
                    <button type="button" id="cancelar-cadastro">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Sucesso -->
    <div id="modal-sucesso" class="modal">
        <div id="modal-sucesso-content" class="modal-content">
            <span id="close-sucesso" class="close">&times;</span>
            <div class="success-icon">‚úÖ</div>
            <h2>Cliente Cadastrado com Sucesso!</h2>
            
            <div id="cliente-cadastrado-info"></div>
            
            <div class="success-actions">
                <button id="cadastrar-outro">Cadastrar Outro Cliente</button>
                <button id="fechar-sucesso">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de produto -->
    <div id="modal-produto" class="modal">
        <div id="modal-produto-content" class="modal-content">
            <span id="close-produto" class="close">&times;</span>
            <div id="produto-details"></div>
        </div>
    </div>

    <!-- Modal de sele√ß√£o m√∫ltipla de produtos -->
    <div id="modal-product-selection" class="modal">
        <div id="modal-product-selection-content" class="modal-content">
            <span id="close-product-selection" class="close">&times;</span>
            <h2>üìã Selecionar Produtos para Jornal de Ofertas</h2>
            
            <div id="product-selection-controls">
                <input type="text" id="search-products-selection" placeholder="Buscar produtos...">
                
                <div class="selection-info">
                    <span id="selected-count">0 produtos selecionados</span>
                    <div class="selection-buttons">
                        <button id="select-all-products" class="selection-btn">Selecionar Todos</button>
                        <button id="deselect-all-products" class="selection-btn">Desmarcar Todos</button>
                    </div>
                </div>
            </div>

            <div id="products-selection-list"></div>

            <div class="format-selection">
                <h3>Como deseja gerar o jornal de ofertas?</h3>
                <div class="format-buttons">
                    <button id="generate-text-offers" class="format-btn text-btn" disabled>üìù Copiar Texto</button>
                    <button id="generate-image-offers" class="format-btn image-btn" disabled>üñºÔ∏è Gerar Imagem</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para exibir texto gerado -->
    <div id="modal-text-offers" class="modal">
        <div id="modal-text-offers-content" class="modal-content">
            <span id="close-text-offers" class="close">&times;</span>
            <h2>üìù Jornal de Ofertas - Texto</h2>
            
            <div id="offers-text-container">
                <textarea id="offers-text" readonly></textarea>
            </div>
            
            <div style="text-align: center; margin-top: 20px;">
                <button id="copy-offers-text" class="format-btn text-btn">üìã Copiar para √Årea de Transfer√™ncia</button>
                <button id="close-text-modal" class="format-btn cancel-btn">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal de sele√ß√£o de clientes para WhatsApp -->
    <div id="modal-clientes-whatsapp" class="modal">
        <div id="modal-clientes-whatsapp-content" class="modal-content">
            <span id="close-clientes-whatsapp" class="close">&times;</span>
            <h2>üì± Enviar via WhatsApp</h2>
            
            <div id="whatsapp-controls">
                <input type="text" id="search-clientes" placeholder="Buscar clientes...">
                
                <div class="selection-info">
                    <div class="checkbox-container">
                        <input type="checkbox" id="include-ativos-whatsapp" checked>
                        <span>Incluir ativos</span>
                    </div>
                    <div class="checkbox-container">
                        <input type="checkbox" id="include-inativos-whatsapp">
                        <span>Incluir inativos</span>
                    </div>
                </div>

                <div class="selection-info">
                    <span id="selected-clients-count">0 clientes selecionados</span>
                    <div class="selection-buttons">
                        <button id="select-all-clients" class="selection-btn">Selecionar Todos</button>
                        <button id="deselect-all-clients" class="selection-btn">Desmarcar Todos</button>
                        <button id="send-to-selected" class="format-btn text-btn" disabled>üì± Enviar para Selecionados</button>
                    </div>
                </div>
            </div>

            <div id="clientes-whatsapp-list"></div>
        </div>
    </div>

    <button id="install-btn">üì± Instalar App</button>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';</script>
    
    <script src="database.js"></script>
    <script src="client-manager.js"></script>
    <script src="catalog.js"></script>
    <script src="map.js"></script>
    <script src="script.js"></script>
    
    <script>
        // Inicializar managers globais
        window.clientManager = new ClientManager();
        window.catalogManager = new CatalogManager();
    </script>
</body>
</html>
