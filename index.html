<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gerenciamento de Clientes</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    #modal-content {
      display: flex;
      flex-direction: column;
      gap: 22px;
    }
    .cliente-info {
      background: #f8f8f8;
      padding: 12px 16px;
      border-radius: 7px;
      margin-bottom: 0;
    }
    .acoes-rapidas {
      display: flex;
      gap: 16px;
      justify-content: flex-start;
      margin-bottom: 0;
    }
    .acoes-rapidas a {
      flex: 1 1 0;
      margin: 0;
    }
    fieldset {
      border: 1px solid #ddd;
      border-radius: 7px;
      padding: 12px 16px 16px 16px;
      margin: 0;
    }
    fieldset legend {
      font-weight: bold;
      font-size: 1em;
      padding: 0 8px;
    }
    .status-btns {
      display: flex;
      gap: 12px;
      margin-top: 10px;
    }
    #editDataPedido, #labelEditDataPedido {
      margin-bottom: 8px;
      margin-right: 8px;
    }
    .observacoes {
      display: flex;
      flex-direction: column;
      gap: 7px;
    }
    #observacoes-contador {
      align-self: flex-end;
    }
    @media (max-width: 600px) {
      #modal-content {
        gap: 14px;
      }
      .acoes-rapidas {
        flex-direction: column;
        gap: 8px;
      }
      .status-btns {
        flex-direction: column;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <h1>Gerenciamento de Clientes</h1>

  <div id="tabs">
    <button onclick="openTab('inativos')" class="active">Inativos</button>
    <button onclick="openTab('ativos')">Ativos</button>
    <button onclick="openTab('agenda')">Agenda</button>
  </div>

  <div id="inativos-content" class="tab-content active">
    <div id="inativos-controls">
      <div id="upload">
        <input type="file" id="xlsxFile" accept=".xlsx,.xls">
      </div>
      <div id="filters">
        <input type="number" id="saldoFilter" placeholder="Saldo mínimo" min="0" step="0.01">
        <select id="sortOption">
          <option value="nome-az">Nome Fantasia (A-Z)</option>
          <option value="nome-za">Nome Fantasia (Z-A)</option>
          <option value="saldo-desc">Saldo de Crédito (Maior-Menor)</option>
          <option value="saldo-asc">Saldo de Crédito (Menor-Maior)</option>
          <option value="data-asc">Data Último Pedido (Antigo-Recente)</option>
          <option value="data-desc">Data Último Pedido (Recente-Antigo)</option>
        </select>
        <div id="cidadeSelector" onclick="toggleCidades()">
          <span id="cidadeSelectorText">Selecionar cidades</span>
          <span class="seta">&#9660;</span>
        </div>
        <div id="cidadeList" class="escondido"></div>
      </div>
    </div>
    <ul id="list"></ul>
  </div>

  <div id="ativos-content" class="tab-content">
    <ul id="ativos-list"></ul>
  </div>

  <div id="agenda-content" class="tab-content">
    <div id="agenda-list"></div>
  </div>

  <div id="modal">
    <div id="modal-content">
      <span id="close">&times;</span>

      <!-- Informações do Cliente -->
      <div class="cliente-info" id="details"></div>

      <!-- Ações Rápidas -->
      <div class="acoes-rapidas" id="acoes-rapidas"></div>

      <!-- Agendamento -->
      <fieldset class="agendamento">
        <legend>Agendamento</legend>
        <div>
          <label for="diaSemana">Dia da Semana:</label>
          <select id="diaSemana">
            <option value="">Selecione</option>
            <option value="Domingo">Domingo</option>
            <option value="Segunda">Segunda</option>
            <option value="Terça">Terça</option>
            <option value="Quarta">Quarta</option>
            <option value="Quinta">Quinta</option>
            <option value="Sexta">Sexta</option>
            <option value="Sábado">Sábado</option>
          </select>
        </div>
        <div>
          <label for="horario">Horário:</label>
          <input type="time" id="horario">
        </div>
        <div>
          <label for="tipo">Tipo:</label>
          <select id="tipo">
            <option value="">Selecione</option>
            <option value="Visita">Visita</option>
            <option value="Ligação">Ligação</option>
            <option value="WhatsApp">WhatsApp</option>
          </select>
        </div>
        <div>
          <label for="repeticao">Repetição:</label>
          <select id="repeticao">
            <option value="Única">Única</option>
            <option value="Semanal">Semanal</option>
            <option value="Quinzenal">Quinzenal</option>
            <option value="Mensal">Mensal</option>
          </select>
        </div>
        <button id="salvarAgendamento" onclick="saveSchedule()">Salvar agendamento</button>
      </fieldset>

      <!-- Status do Cliente -->
      <fieldset class="status">
        <legend>Status</legend>
        <div style="margin-bottom: 8px;">
          <label for="editDataPedido" style="display:none;" id="labelEditDataPedido">Data Último Pedido:</label>
          <input type="text" id="editDataPedido" placeholder="DD/MM/AAAA" style="display:none;" maxlength="10">
        </div>
        <div class="status-btns">
          <button id="tornarAtivo" onclick="prepareTornarAtivo()">Tornar Ativo</button>
          <button id="confirmarAtivo" onclick="tornarAtivo()" style="display:none;">Confirmar Ativo</button>
          <button id="excluirAtivo" onclick="excluirAtivo()" style="display:none;">Excluir dos Ativos</button>
        </div>
      </fieldset>

      <!-- Observações -->
      <fieldset class="observacoes">
        <legend>Observações</legend>
        <textarea id="observacoes" maxlength="2000"></textarea>
        <div id="observacoes-contador">0/2000</div>
        <button id="salvarObservacoes">Salvar Observações</button>
      </fieldset>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="script.js"></script>
  <script>
    // Organização dos botões de ação rápida no modal
    function updateAcoesRapidas(item) {
      const acoes = document.getElementById('acoes-rapidas');
      if (!acoes) return;
      acoes.innerHTML = '';
      // WhatsApp
      if (item.Celular) {
        const cleanNumber = item.Celular.replace(/\D/g, '');
        if (cleanNumber.length >= 10) {
          const whatsappLink = document.createElement('a');
          whatsappLink.href = `https://wa.me/55${cleanNumber}`;
          whatsappLink.textContent = 'Abrir WhatsApp';
          whatsappLink.className = 'whatsapp-btn';
          whatsappLink.target = '_blank';
          acoes.appendChild(whatsappLink);
        }
      }
      // Google Maps
      const address = encodeURIComponent(`${item.Endereco || ''}, ${item.Numero || ''}, ${item.Bairro || ''}, ${item.Cidade || ''}, ${item.UF || ''}, ${item.CEP || ''}`);
      const mapLink = document.createElement('a');
      mapLink.href = `https://www.google.com/maps/search/?api=1&query=${address}`;
      mapLink.textContent = 'Abrir no Google Maps';
      mapLink.className = 'whatsapp-btn';
      mapLink.target = '_blank';
      acoes.appendChild(mapLink);
    }
    window.updateAcoesRapidas = updateAcoesRapidas;
  </script>
</body>
</html>
