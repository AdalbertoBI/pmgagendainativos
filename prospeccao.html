<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMG - Prospec√ß√£o Inteligente</title>
    <link rel="stylesheet" href="prospeccao.css?v=1.1.3.0">
    <link rel="stylesheet" href="social-media-styles.css?v=1.1.3.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- IA Local no Navegador - Transformers.js -->
    <script type="module">
        import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.1';
        
        // Configurar para usar local (sem downloads externos)
        env.allowRemoteModels = false;
        env.allowLocalModels = true;
        
        window.transformers = { pipeline, env };
        console.log('ü§ñ Transformers.js carregado com sucesso!');
    </script>
    <!-- IA Alternativa: Brain.js para processamento local -->
    <script src="https://cdn.jsdelivr.net/npm/brain.js@2.0.0-beta.23/dist/brain-browser.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="logo.png" alt="Logo da Empresa" class="company-logo" crossorigin="anonymous">
                <h1>Prospec√ß√£o Inteligente</h1>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="form-section">
            <div class="card">
                <h2><i class="fas fa-search"></i> Dados do Cliente</h2>
                <form id="prospectForm">
                    <div class="form-group">
                        <label for="cnpj">CNPJ:</label>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="cnpj" placeholder="00.000.000/0001-00" required style="flex: 1; min-width: 200px;">
                            <button type="button" id="searchCnpj" class="btn btn-secondary">
                                <i class="fas fa-search"></i> Buscar API
                            </button>
                            <button type="button" id="searchClients" class="btn btn-primary" style="background: #28a745;">
                                <i class="fas fa-users"></i> Buscar Clientes
                            </button>
                        </div>
                        <small>Digite o CNPJ ou use "Buscar Clientes" para ver lista de clientes ativos/inativos. O enriquecimento de dados ser√° feito automaticamente.</small>
                    </div>

                    <!-- Modal para sele√ß√£o de clientes -->
                    <div id="clientModal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                            <div class="modal-header">
                                <h2><i class="fas fa-users"></i> Selecionar Cliente</h2>
                                <span class="close" id="closeClientModal">&times;</span>
                            </div>
                            <div style="padding: 20px; overflow-y: auto; max-height: 60vh;">
                                <div style="margin-bottom: 15px;">
                                    <input type="text" id="clientSearch" placeholder="Buscar por nome ou CNPJ..." 
                                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                </div>
                                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                    <button type="button" id="showActiveClients" class="btn btn-success filter-btn" data-filter="active">
                                        <i class="fas fa-check-circle"></i> Ativos
                                    </button>
                                    <button type="button" id="showInactiveClients" class="btn btn-secondary filter-btn" data-filter="inactive">
                                        <i class="fas fa-pause-circle"></i> Inativos
                                    </button>
                                </div>
                                <div id="clientList" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Lista de clientes ser√° carregada aqui -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="keywords">Palavras-chave do Card√°pio:</label>
                        <textarea id="keywords" placeholder="Digite palavras-chave do card√°pio separadas por v√≠rgula (ex: pizza, hamb√∫rguer, refrigerante, a√ßa√≠, carne, frango, batata frita, sorvete)" 
                                  rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; resize: vertical; font-family: inherit;"></textarea>
                        <small>Digite palavras-chave que descrevem o card√°pio do cliente para sugest√µes mais precisas</small>
                        <div style="margin-top: 10px;">
                            <strong>üí° Clique nos segmentos para adicionar insumos automaticamente:</strong>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; margin-top: 12px; align-items: center;">
                                <span class="keyword-example" onclick="selectBusinessSegment('pizzaria', 'pizza, mussarela, molho de tomate, farinha, fermento, oregano, azeitona, calabresa, presunto, queijo')">üçï Pizzaria</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('restaurante', 'carne bovina, frango, peixe, arroz, feij√£o, √≥leo, temperos, legumes, verduras, batata, cebola')">üçΩÔ∏è Restaurante</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('lanchonete', 'p√£o hamb√∫rguer, carne, frango, batata frita, refrigerante, maionese, ketchup, mostarda, alface, tomate')">üçî Lanchonete</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('padaria', 'farinha trigo, fermento, a√ß√∫car, ovos, leite, manteiga, sal, chocolate, frutas, recheios')">ü•ñ Padaria</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('supermercado', 'carnes, frios, latic√≠nios, bebidas, enlatados, congelados, higiene, limpeza, hortifruti, cereais')">üõí Supermercado</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('pastelaria', 'massa pastel, √≥leo fritura, queijo, presunto, carne mo√≠da, palmito, catupiry, molhos')">ü•ü Pastelaria</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('bar', 'cerveja, bebidas alco√≥licas, refrigerantes, petiscos, amendoim, azeitona, queijos, carnes frias')">üç∫ Bar/Choperia</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('mercearia', 'arroz, feij√£o, a√ß√∫car, √≥leo, enlatados, massas, temperos, produtos limpeza, bebidas')">üè™ Mercearia</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('hotel', 'carnes, aves, peixes, frutos mar, temperos, sal grosso, embalagens, papel filme, luvas')">üè® Hotel/Pousada</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('esfiharia', 'massa esfiha, carne, cebola, tomate, temperos √°rabes, queijo, ricota, espinafre')">ü•ô Esfiharia</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('oriental', 'shoyu, miss√¥, nori, wasabi, gengibre, sake, arroz sushi, salm√£o, atum, pepino japon√™s')">üç± Cozinha Oriental</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('industrial', 'ingredientes grande escala, carnes, verduras, temperos, √≥leo, arroz, feij√£o, massas, conservas')">üè≠ Cozinha Industrial</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('churrascaria', 'carne bovina, lingui√ßa, frango, sal grosso, carv√£o, farofa, vinagrete, p√£o alho')">üî• Churrascaria</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('massas', 'farinha trigo, ovos, semolina, massa fresca, molhos, queijos, azeite, ervas')">üçù F√°brica Massas</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('confeitaria', 'a√ß√∫car, chocolate, farinha, ovos, leite, creme leite, frutas, ess√™ncias, corantes, confeitos')">üßÅ Confeitaria</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('latic√≠nios', 'leite, queijos, iogurte, manteiga, creme leite, requeij√£o, embalagens, conservantes')">üßÄ Latic√≠nios</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('conveni√™ncia', 'refrigerantes, sucos, √°gua, snacks, salgadinhos, doces, cigarros, produtos conveni√™ncia')">üè™ Loja Conveni√™ncia</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('a√ßougue', 'carnes bovinas, su√≠nas, aves, peixes, temperos, sal, embalagens, papel, luvas descart√°veis')">ü•© A√ßougue</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('rotisserie', 'frango assado, temperos, √≥leo, batata, polenta, farofa, molhos, embalagens')">üçó Rotisserie</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('adega', 'vinhos, espumantes, cervejas especiais, queijos, embutidos, petiscos gourmet, ta√ßas')">üç∑ Adega</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('clube', 'ingredientes eventos, carnes, saladas, bebidas, descart√°veis, decora√ß√£o comest√≠vel')">üèõÔ∏è Clube/Associa√ß√£o</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('buffet', 'pratos prontos, saladas, carnes, acompanhamentos, sobremesas, bebidas, descart√°veis')">üçΩÔ∏è Buffet</span>
                                <span class="keyword-example" onclick="selectBusinessSegment('hamburgueria', 'p√£o hamb√∫rguer, carne, bacon, queijo, alface, tomate, batata, molhos, refrigerantes')">üçî Hamburgueria</span>
                            </div>
                        </div>
                    </div>

                    <!-- üì± SE√á√ÉO DE REDES SOCIAIS MANUAIS -->
                    <div class="form-group">
                        <label><i class="fab fa-instagram"></i> Redes Sociais do Cliente:</label>
                        
                        <!-- Formul√°rio para adicionar rede social -->
                        <div class="social-media-form" style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 15px; border: 2px solid #e9ecef;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr auto; gap: 10px; align-items: end;">
                                <div>
                                    <label for="socialPlatform" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Rede Social</label>
                                    <select id="socialPlatform" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                        <option value="">Selecione...</option>
                                        <option value="Instagram">üì∑ Instagram</option>
                                        <option value="Facebook">üë• Facebook</option>
                                        <option value="WhatsApp Business">üí¨ WhatsApp Business</option>
                                        <option value="TikTok">üéµ TikTok</option>
                                        <option value="YouTube">üì∫ YouTube</option>
                                        <option value="LinkedIn">üíº LinkedIn</option>
                                        <option value="Twitter">üê¶ Twitter/X</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="socialPublications" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Publica√ß√µes</label>
                                    <input type="number" id="socialPublications" placeholder="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
                                    <label for="socialFollowers" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Seguidores</label>
                                    <input type="number" id="socialFollowers" placeholder="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
                                    <label for="socialFollowing" style="font-size: 14px; font-weight: 500; color: #495057; margin-bottom: 5px; display: block;">Seguindo</label>
                                    <input type="number" id="socialFollowing" placeholder="0" min="0" style="width: 100%; padding: 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 14px;">
                                </div>
                                <div>
                                    <button type="button" id="addSocialMedia" class="btn btn-success" style="padding: 8px 16px; font-size: 14px; white-space: nowrap;">
                                        <i class="fas fa-plus"></i> Cadastrar
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Lista de redes sociais cadastradas -->
                        <div id="socialMediaList" class="social-media-list" style="margin-top: 15px;">
                            <!-- Redes sociais cadastradas aparecer√£o aqui -->
                        </div>
                        
                        <small class="text-muted">
                            üìù <strong>Dica:</strong> Adicione as redes sociais do cliente para uma an√°lise mais precisa. 
                            Demografia e oportunidade ser√£o calculadas automaticamente baseadas no CNPJ e redes sociais.
                        </small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Analisar e Criar Prospec√ß√£o
                    </button>
                </form>
            </div>

            <div class="loading-section" id="loadingSection" style="display: none;">
                <div class="card">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <h3>Analisando dados do cliente... </h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="loading-steps">
                        <div class="step" id="step1">
                            <i class="fas fa-building"></i> Coletando dados da empresa
                        </div>
                        <div class="step" id="step2">
                            <i class="fas fa-map-marker-alt"></i> Analisando localiza√ß√£o
                        </div>
                        <div class="step" id="step3">
                            <i class="fas fa-utensils"></i> Processando card√°pio
                        </div>
                        <div class="step" id="step4">
                            <i class="fas fa-chart-line"></i> Sugerindo produtos
                        </div>
                        <div class="step" id="step5">
                            <i class="fas fa-palette"></i> Criando arte personalizada
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="company-info card">
                <h2><i class="fas fa-building"></i> Informa√ß√µes da Empresa</h2>
                <div id="companyDetails"></div>
            </div>

            <div class="sales-script card">
                <h2><i class="fas fa-microphone"></i> Script de Vendas Personalizado</h2>
                <div id="salesScript"></div>
                <button id="copySalesScript" class="btn btn-secondary">
                    <i class="fas fa-copy"></i> Copiar Script
                </button>
            </div>
            

            <div class="product-suggestions card">
                <h2><i class="fas fa-lightbulb"></i> Produtos Sugeridos</h2>
                
                <div id="productSuggestions"></div>
                <div class="offer-actions" style="display: flex; gap: 10px; margin-top: 15px; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <button id="copyOfferText" class="btn btn-primary">
                        <i class="fas fa-copy"></i> Copiar Texto
                    </button>
                    <button id="copyOfferImage" class="btn btn-success">
                        <i class="fas fa-image"></i> Copiar Imagem
                    </button>
                    
                    <!-- ‚úÖ SELETOR DE FAIXA DE PRE√áO -->
                    <label for="price-band-select-prosp" style="margin-left: 20px; font-weight: 500; color: #333;">Faixa de pre√ßo:</label>
                    <select id="price-band-select-prosp" class="btn btn-secondary" style="min-width: 160px; height: 38px; border: 1px solid #ddd; border-radius: 4px; padding: 0 8px;">
                        <option value="retira">Retira R$</option>
                        <option value="entrega">Entrega R$</option>
                        <option value="km100_199">100 a 199 km</option>
                        <option value="km200_299">200 a 299 km</option>
                        <option value="km300_399">300 a 399 km</option>
                        <option value="km400_499">400 a 499 km</option>
                        <option value="km500_599">500 a 599 km</option>
                        <option value="km600_plus">Acima 600km</option>
                    </select>
                    
                    <!-- Controle de fundo din√¢mico ao lado dos bot√µes -->
                    <label style="display:inline-flex; align-items:center; gap:6px; margin-left: 15px; font-weight: 500; color: #333;">
                        <input type="checkbox" id="toggle-dynamic-bg-prosp"> Fundo din√¢mico
                    </label>
                </div>
            </div>

            
        </div>
    </div>

    <!-- Modal para Arte da Oferta -->
<div id="offerModal" class="offer-customized card" style="display: none;">
    <div class="modal-header">
        <h2><i class="fas fa-palette"></i> Arte da Oferta Personalizada</h2>
        <span class="close-btn" id="closeModal">&times;</span>
    </div>
    <div class="offer-customized-content">
        <div class="offer-preview" id="offerPreview">
            <!-- Arte ser√° gerada aqui -->
            <p>PMG 30 Anos</p>
            <h3>Oferta Especial<br>Personalizada para <span id="clientName">NOME DA EMPRESA</span></h3>
            <div class="offer-products" id="dynamicOfferProducts">
                <!-- Produtos escolhidos pelo usu√°rio ser√£o inseridos aqui dinamicamente -->
            </div>
        </div>
    </div>
    <div class="modal-buttons" style="margin-top: 20px; text-align: center;">
    <button id="copyOfferImage" class="btn-primary" style="margin-right: 10px; background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        üìã Copiar Imagem
    </button>
    <button id="copyOfferText" class="btn-secondary" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        üìÑ Copiar Texto
    </button>
</div>
</div>

    <script src="prospeccao.js?v=1.1.11.0"></script>
    <script src="cnpj-api.js?v=1.1.2.0"></script>
    <script src="enriquecimento-dados.js?v=1.1.2.0"></script>
    <!-- Script de teste removido para produ√ß√£o -->
    <!-- <script src="test-prospeccao.js"></script> -->
    <script>
        // Sistema de Redes Sociais Manuais
        window.socialMediaData = [];

        // Funcionalidade para adicionar redes sociais
        document.addEventListener('DOMContentLoaded', function() {
            const addButton = document.getElementById('addSocialMedia');
            if (addButton) {
                addButton.addEventListener('click', addSocialMedia);
            }
        });

        function addSocialMedia() {
            const platform = document.getElementById('socialPlatform').value;
            const publications = document.getElementById('socialPublications').value;
            const followers = document.getElementById('socialFollowers').value;
            const following = document.getElementById('socialFollowing').value;

            if (!platform) {
                alert('‚ùå Por favor, selecione uma rede social!');
                return;
            }

            // Verificar se a rede social j√° foi adicionada
            const existingSocial = window.socialMediaData.find(item => item.platform === platform);
            if (existingSocial) {
                alert('‚ùå Esta rede social j√° foi adicionada! Remova-a primeiro para adicionar novamente.');
                return;
            }

            const socialData = {
                platform: platform,
                publications: parseInt(publications) || 0,
                followers: parseInt(followers) || 0,
                following: parseInt(following) || 0
            };

            // Adicionar aos dados globais
            window.socialMediaData.push(socialData);

            // Atualizar a lista visual
            updateSocialMediaList();

            // Limpar o formul√°rio
            clearSocialForm();

            console.log('‚úÖ Rede social adicionada:', socialData);
        }

        function updateSocialMediaList() {
            const listContainer = document.getElementById('socialMediaList');
            if (!listContainer) return;

            if (window.socialMediaData.length === 0) {
                listContainer.innerHTML = '';
                return;
            }

            let html = '<h4 style="margin-bottom: 15px; color: #495057;"><i class="fas fa-list"></i> Redes Sociais Cadastradas:</h4>';
            
            window.socialMediaData.forEach((social, index) => {
                html += `
                    <div class="social-media-item" style="background: white; border: 1px solid #dee2e6; border-radius: 8px; padding: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                        <div style="flex: 1;">
                            <strong style="color: #495057;">${social.platform}</strong>
                            <div style="font-size: 14px; color: #6c757d; margin-top: 5px;">
                                üìÑ ${social.publications} publica√ß√µes ‚Ä¢ 
                                üë• ${social.followers.toLocaleString()} seguidores ‚Ä¢ 
                                ‚û°Ô∏è ${social.following.toLocaleString()} seguindo
                            </div>
                        </div>
                        <button onclick="removeSocialMedia(${index})" class="btn btn-sm" style="background: #dc3545; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                            <i class="fas fa-trash"></i> Remover
                        </button>
                    </div>
                `;
            });

            listContainer.innerHTML = html;
        }

        function removeSocialMedia(index) {
            window.socialMediaData.splice(index, 1);
            updateSocialMediaList();
            console.log('üóëÔ∏è Rede social removida. Lista atual:', window.socialMediaData);
        }

        function clearSocialForm() {
            document.getElementById('socialPlatform').value = '';
            document.getElementById('socialPublications').value = '';
            document.getElementById('socialFollowers').value = '';
            document.getElementById('socialFollowing').value = '';
        }

        // Fun√ß√£o para obter dados das redes sociais (usada pelo sistema de prospec√ß√£o)
        function getSocialMediaAnalysis() {
            if (window.socialMediaData.length === 0) {
                return null;
            }

            const totalFollowers = window.socialMediaData.reduce((sum, social) => sum + social.followers, 0);
            const totalPublications = window.socialMediaData.reduce((sum, social) => sum + social.publications, 0);
            const platforms = window.socialMediaData.map(social => social.platform);

            // Calcular engajamento estimado baseado nos dados
            let engagementLevel = 'Baixo';
            if (totalFollowers > 1000 && totalPublications > 50) {
                engagementLevel = 'Alto';
            } else if (totalFollowers > 500 || totalPublications > 20) {
                engagementLevel = 'M√©dio';
            }

            return {
                platforms: platforms,
                totalFollowers: totalFollowers,
                totalPublications: totalPublications,
                engagementLevel: engagementLevel,
                details: window.socialMediaData
            };
        }

        // Sincronizar com localStorage
        (function(){
            try {
                var band = localStorage.getItem('priceBand') || 'retira';
                var sel = document.getElementById('price-band-select-prosp');
                if (sel) sel.value = band;
            } catch(e) {}
        })();
        
        // üîß FUN√á√ÉO DE DEBUG PARA VERIFICAR SISTEMA
        window.debugProspeccaoSystem = function() {
            console.log('üîß DEBUG DO SISTEMA DE PROSPEC√á√ÉO');
            console.log('================================');
            
            console.log('1. ProspeccaoManager class:', typeof ProspeccaoManager);
            console.log('2. Inst√¢ncia global:', !!window.prospeccaoManager);
            console.log('3. Fun√ß√£o de init:', typeof window.initProspeccaoManager);
            
            if (window.prospeccaoManager) {
                const manager = window.prospeccaoManager;
                console.log('4. M√©todos dispon√≠veis:');
                console.log('   - generateSalesScript:', typeof manager.generateSalesScript);
                console.log('   - generateSocialRecommendations:', typeof manager.generateSocialRecommendations);
                console.log('   - generateMarketOpportunities:', typeof manager.generateMarketOpportunities);
                console.log('   - copyScriptSection:', typeof manager.copyScriptSection);
                console.log('   - enhanceScriptWithAI:', typeof manager.enhanceScriptWithAI);
                console.log('   - detectBusinessSegment:', typeof manager.detectBusinessSegment);
                
                console.log('5. Estado interno:');
                console.log('   - Cat√°logo carregado:', manager.catalog?.length || 0, 'produtos');
                console.log('   - Imagens carregadas:', Object.keys(manager.imagesMap || {}).length);
                console.log('   - Prospec√ß√£o atual:', !!manager.currentProspect);
            }
            
            console.log('================================');
            console.log('üí° Use window.initProspeccaoManager() para tentar reinicializar');
        };
        
        // üéØ NOVA FUN√á√ÉO: Selecionar segmento de neg√≥cio
        window.selectBusinessSegment = function(segment, keywords) {
            console.log('üéØ Segmento selecionado:', segment);
            
            // Adicionar palavras-chave
            const keywordsField = document.getElementById('keywords');
            if (keywordsField) {
                keywordsField.value += (keywordsField.value ? ', ' : '') + keywords;
                
                // Destacar visualmente que foi selecionado
                keywordsField.style.borderColor = '#28a745';
                keywordsField.style.borderWidth = '2px';
                
                setTimeout(() => {
                    keywordsField.style.borderColor = '';
                    keywordsField.style.borderWidth = '';
                }, 2000);
            }
            
            // Armazenar segmento selecionado globalmente
            window.selectedBusinessSegment = segment;
            
            // Mostrar notifica√ß√£o
            showSegmentNotification(segment);
            
            // Se j√° existe uma prospec√ß√£o, aplicar o segmento
            if (window.prospeccaoManager && window.prospeccaoManager.currentProspect) {
                window.prospeccaoManager.currentProspect.detectedSegment = segment;
                console.log('‚úÖ Segmento aplicado √† prospec√ß√£o atual');
            }
        };
        
        // üì± Mostrar notifica√ß√£o de segmento selecionado
        function showSegmentNotification(segment) {
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: #17a2b8; color: white; 
                            padding: 15px 20px; border-radius: 8px; z-index: 10000; 
                            box-shadow: 0 4px 12px rgba(0,0,0,0.3); animation: slideInRight 0.3s ease;">
                    <i class="fas fa-tag"></i> <strong>Segmento Selecionado:</strong> ${segment}
                    <br><small>Palavras-chave adicionadas automaticamente</small>
                </div>
                <style>
                    @keyframes slideInRight {
                        from { transform: translateX(100%); opacity: 0; }
                        to { transform: translateX(0); opacity: 1; }
                    }
                </style>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 4000);
        }
        
        // ü§ñ Auto-detectar segmento baseado em palavras-chave digitadas
        document.addEventListener('DOMContentLoaded', function() {
            const keywordsField = document.getElementById('keywords');
            if (keywordsField) {
                keywordsField.addEventListener('input', function() {
                    const keywords = this.value.toLowerCase();
                    const detectedSegment = autoDetectSegment(keywords);
                    
                    if (detectedSegment && detectedSegment !== window.lastDetectedSegment) {
                        window.lastDetectedSegment = detectedSegment;
                        window.selectedBusinessSegment = detectedSegment;
                        
                        console.log('ü§ñ Segmento auto-detectado:', detectedSegment);
                        
                        // Mostrar sugest√£o discreta
                        showAutoDetectionSuggestion(detectedSegment);
                    }
                });
            }
        });
        
        // üß† Fun√ß√£o para auto-detectar segmento
        function autoDetectSegment(keywords) {
            const segments = {
                'pizzaria': ['pizza', 'mussarela', 'calabresa', 'molho de tomate', 'oregano'],
                'hamburgueria': ['hamb√∫rguer', 'batata frita', 'bacon', 'maionese', 'ketchup'],
                'a√ßa√≠': ['a√ßa√≠', 'guarana', 'banana', 'granola', 'mel'],
                'padaria': ['p√£o', 'farinha', 'fermento', 'doce', 'bolo'],
                'churrascaria': ['carne', 'churrasco', 'sal grosso', 'farofa', 'vinagrete'],
                'bar': ['cerveja', 'bebida', 'petisco', 'amendoim'],
                'confeitaria': ['chocolate', 'brigadeiro', 'festa', 'anivers√°rio']
            };
            
            let maxScore = 0;
            let detectedSegment = null;
            
            for (const [segment, segmentKeywords] of Object.entries(segments)) {
                const score = segmentKeywords.filter(keyword => keywords.includes(keyword)).length;
                if (score > maxScore && score >= 2) { // Precisa de pelo menos 2 matches
                    maxScore = score;
                    detectedSegment = segment;
                }
            }
            
            return detectedSegment;
        }
        
        // üí° Mostrar sugest√£o de auto-detec√ß√£o
        function showAutoDetectionSuggestion(segment) {
            // Remover sugest√£o anterior se existir
            const existing = document.querySelector('.auto-detection-suggestion');
            if (existing) existing.remove();
            
            const suggestion = document.createElement('div');
            suggestion.className = 'auto-detection-suggestion';
            suggestion.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 20px; background: #ffc107; color: #212529; 
                            padding: 12px 16px; border-radius: 6px; z-index: 10000; 
                            box-shadow: 0 4px 12px rgba(0,0,0,0.2); font-size: 14px;
                            animation: bounceIn 0.5s ease;">
                    <i class="fas fa-lightbulb"></i> <strong>Segmento detectado:</strong> ${segment}
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; margin-left: 10px; cursor: pointer; font-size: 16px;">√ó</button>
                </div>
            `;
            document.body.appendChild(suggestion);
            
            setTimeout(() => {
                if (suggestion.parentElement) suggestion.remove();
            }, 6000);
        }
        
        // Disponibilizar globalmente
        window.debugProspeccaoSystem();
        
    </script>
</body>
</html>
