<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMG - Prospecção Inteligente</title>
    <link rel="stylesheet" href="prospeccao.css?v=2.4.0.0">
    <link rel="stylesheet" href="social-media-styles.css?v=2.4.0.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="logo.png" alt="Logo da Empresa" class="company-logo" crossorigin="anonymous">
                <h1>Prospecção Inteligente</h1>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="form-section">
            <div class="card">
                <h2><i class="fas fa-search"></i> Dados do Cliente</h2>
                <form id="prospectForm">
                    <div class="form-group">
                        <label for="cnpj">CNPJ:</label>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="cnpj" placeholder="00.000.000/0001-00" required style="flex: 1; min-width: 200px;">
                            <button type="button" id="searchCnpj" class="btn btn-secondary">
                                <i class="fas fa-search"></i> Buscar API
                            </button>
                            <button type="button" id="searchClients" class="btn btn-primary" style="background: #28a745;">
                                <i class="fas fa-users"></i> Buscar Clientes
                            </button>
                        </div>
                        <small>Digite o CNPJ ou use "Buscar Clientes" para ver lista de clientes ativos/inativos</small>
                    </div>

                    <!-- Modal para seleção de clientes -->
                    <div id="clientModal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                            <div class="modal-header">
                                <h2><i class="fas fa-users"></i> Selecionar Cliente</h2>
                                <span class="close" id="closeClientModal">&times;</span>
                            </div>
                            <div style="padding: 20px; overflow-y: auto; max-height: 60vh;">
                                <div style="margin-bottom: 15px;">
                                    <input type="text" id="clientSearch" placeholder="Buscar por nome ou CNPJ..." 
                                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                </div>
                                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                    <button type="button" id="showActiveClients" class="btn btn-success filter-btn" data-filter="active">
                                        <i class="fas fa-check-circle"></i> Ativos
                                    </button>
                                    <button type="button" id="showInactiveClients" class="btn btn-secondary filter-btn" data-filter="inactive">
                                        <i class="fas fa-pause-circle"></i> Inativos
                                    </button>
                                </div>
                                <div id="clientList" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Lista de clientes será carregada aqui -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="keywords">Palavras-chave do Cardápio:</label>
                        <textarea id="keywords" placeholder="Digite palavras-chave do cardápio separadas por vírgula (ex: pizza, hambúrguer, refrigerante, açaí, carne, frango, batata frita, sorvete)" 
                                  rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; resize: vertical; font-family: inherit;"></textarea>
                        <small>Digite palavras-chave que descrevem o cardápio do cliente para sugestões mais precisas</small>
                        <div style="margin-top: 10px;">
                            <strong>💡 Clique nos segmentos para adicionar insumos automaticamente:</strong>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 6px; margin-top: 8px;">
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pizza, mussarela, molho de tomate, farinha, fermento, oregano, azeitona, calabresa, presunto, queijo'">🍕 Pizzaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carne bovina, frango, peixe, arroz, feijão, óleo, temperos, legumes, verduras, batata, cebola'">🍽️ Restaurante</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pão hambúrguer, carne, frango, batata frita, refrigerante, maionese, ketchup, mostarda, alface, tomate'">🍔 Lanchonete</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'farinha trigo, fermento, açúcar, ovos, leite, manteiga, sal, chocolate, frutas, recheios'">🥖 Padaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carnes, frios, laticínios, bebidas, enlatados, congelados, higiene, limpeza, hortifruti, cereais'">🛒 Supermercado</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'massa pastel, óleo fritura, queijo, presunto, carne moída, palmito, catupiry, molhos'">🥟 Pastelaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'cerveja, bebidas alcoólicas, refrigerantes, petiscos, amendoim, azeitona, queijos, carnes frias'">🍺 Bar/Choperia</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'arroz, feijão, açúcar, óleo, enlatados, massas, temperos, produtos limpeza, bebidas'">� Mercearia</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carnes, aves, peixes, frutos mar, temperos, sal grosso, embalagens, papel filme, luvas'">🏨 Hotel/Pousada</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'massa esfiha, carne, cebola, tomate, temperos árabes, queijo, ricota, espinafre'">🥙 Esfiharia</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'shoyu, missô, nori, wasabi, gengibre, sake, arroz sushi, salmão, atum, pepino japonês'">🍱 Cozinha Oriental</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'ingredientes grande escala, carnes, verduras, temperos, óleo, arroz, feijão, massas, conservas'">🏭 Cozinha Industrial</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carne bovina, linguiça, frango, sal grosso, carvão, farofa, vinagrete, pão alho'">🔥 Churrascaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'farinha trigo, ovos, semolina, massa fresca, molhos, queijos, azeite, ervas'">� Fábrica Massas</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'açúcar, chocolate, farinha, ovos, leite, creme leite, frutas, essências, corantes, confeitos'">🧁 Confeitaria</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'leite, queijos, iogurte, manteiga, creme leite, requeijão, embalagens, conservantes'">🧀 Laticínios</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'refrigerantes, sucos, água, snacks, salgadinhos, doces, cigarros, produtos conveniência'">🏪 Loja Conveniência</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'carnes bovinas, suínas, aves, peixes, temperos, sal, embalagens, papel, luvas descartáveis'">🥩 Açougue</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'frango assado, temperos, óleo, batata, polenta, farofa, molhos, embalagens'">🍗 Rotisserie</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'vinhos, espumantes, cervejas especiais, queijos, embutidos, petiscos gourmet, taças'">🍷 Adega</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'ingredientes eventos, carnes, saladas, bebidas, descartáveis, decoração comestível'">🏛️ Clube/Associação</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pratos prontos, saladas, carnes, acompanhamentos, sobremesas, bebidas, descartáveis'">�️ Buffet</span>
                                <span class="keyword-example" onclick="document.getElementById('keywords').value += (document.getElementById('keywords').value ? ', ' : '') + 'pão hambúrguer, carne, bacon, queijo, alface, tomate, batata, molhos, refrigerantes'">🍔 Hamburgueria</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Analisar e Criar Prospecção
                    </button>
                </form>
            </div>

            <div class="loading-section" id="loadingSection" style="display: none;">
                <div class="card">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <h3>Analisando dados do cliente... </h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="loading-steps">
                        <div class="step" id="step1">
                            <i class="fas fa-building"></i> Coletando dados da empresa
                        </div>
                        <div class="step" id="step2">
                            <i class="fas fa-map-marker-alt"></i> Analisando localização
                        </div>
                        <div class="step" id="step3">
                            <i class="fas fa-utensils"></i> Processando cardápio
                        </div>
                        <div class="step" id="step4">
                            <i class="fas fa-chart-line"></i> Sugerindo produtos
                        </div>
                        <div class="step" id="step5">
                            <i class="fas fa-palette"></i> Criando arte personalizada
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="company-info card">
                <h2><i class="fas fa-building"></i> Informações da Empresa</h2>
                <div id="companyDetails"></div>
            </div>

            <div class="menu-analysis card">
                <h2><i class="fas fa-chart-pie"></i> Análise do Cardápio</h2>
                <div id="menuAnalysis"></div>
            </div>

            <div class="sales-script card">
                <h2><i class="fas fa-microphone"></i> Script de Vendas Personalizado</h2>
                <div id="salesScript"></div>
                <button id="copySalesScript" class="btn btn-secondary">
                    <i class="fas fa-copy"></i> Copiar Script
                </button>
            </div>
            

            <div class="product-suggestions card">
                <h2><i class="fas fa-lightbulb"></i> Produtos Sugeridos</h2>
                
                <div id="productSuggestions"></div>
                <div class="offer-actions" style="display: flex; gap: 10px; margin-top: 15px; align-items: center; justify-content: center; flex-wrap: wrap;">
                    <button id="copyOfferText" class="btn btn-primary">
                        <i class="fas fa-copy"></i> Copiar Texto
                    </button>
                    <button id="copyOfferImage" class="btn btn-success">
                        <i class="fas fa-image"></i> Copiar Imagem
                    </button>
                    
                    <!-- ✅ SELETOR DE FAIXA DE PREÇO -->
                    <label for="price-band-select-prosp" style="margin-left: 20px; font-weight: 500; color: #333;">Faixa de preço:</label>
                    <select id="price-band-select-prosp" class="btn btn-secondary" style="min-width: 160px; height: 38px; border: 1px solid #ddd; border-radius: 4px; padding: 0 8px;">
                        <option value="retira">Retira R$</option>
                        <option value="entrega">Entrega R$</option>
                        <option value="km100_199">100 a 199 km</option>
                        <option value="km200_299">200 a 299 km</option>
                        <option value="km300_399">300 a 399 km</option>
                        <option value="km400_499">400 a 499 km</option>
                        <option value="km500_599">500 a 599 km</option>
                        <option value="km600_plus">Acima 600km</option>
                    </select>
                    
                    <!-- Controle de fundo dinâmico ao lado dos botões -->
                    <label style="display:inline-flex; align-items:center; gap:6px; margin-left: 15px; font-weight: 500; color: #333;">
                        <input type="checkbox" id="toggle-dynamic-bg-prosp"> Fundo dinâmico
                    </label>
                </div>
            </div>

            
        </div>
    </div>

    <!-- Modal para Arte da Oferta -->
<div id="offerModal" class="offer-customized card" style="display: none;">
    <div class="modal-header">
        <h2><i class="fas fa-palette"></i> Arte da Oferta Personalizada</h2>
        <span class="close-btn" id="closeModal">&times;</span>
    </div>
    <div class="offer-customized-content">
        <div class="offer-preview" id="offerPreview">
            <!-- Arte será gerada aqui -->
            <p>PMG 30 Anos</p>
            <h3>Oferta Especial<br>Personalizada para <span id="clientName">REAL PARMA</span></h3>
            <div class="offer-products" id="dynamicOfferProducts">
                <!-- Produtos escolhidos pelo usuário serão inseridos aqui dinamicamente -->
            </div>
        </div>
    </div>
    <div class="modal-buttons" style="margin-top: 20px; text-align: center;">
    <button id="copyOfferImage" class="btn-primary" style="margin-right: 10px; background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        📋 Copiar Imagem
    </button>
    <button id="copyOfferText" class="btn-secondary" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        📄 Copiar Texto
    </button>
</div>
</div>

    <script src="prospeccao.js?v=2.4.0.0"></script>
    <script src="social-media-analyzer.js?v=2.4.0.0"></script>
    <script>
        // Sincroniza valor inicial do seletor com localStorage, caso o JS principal demore
        (function(){
            try {
                var band = localStorage.getItem('priceBand') || 'retira';
                var sel = document.getElementById('price-band-select-pros');
                if (sel) sel.value = band;
            } catch(e) {}
        })();
    </script>
</body>
</html>
