<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PMG - Prospec칞칚o Inteligente</title>
    <link rel="stylesheet" href="prospeccao.css?v=2.4.0.0">
    <link rel="stylesheet" href="social-media-styles.css?v=2.4.0.0">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <img src="logo.png" alt="Logo da Empresa" class="company-logo" crossorigin="anonymous">
                <h1>Prospec칞칚o Inteligente</h1>
            </div>
            <div class="price-band-control" style="margin-left:auto; display:flex; align-items:center; gap:8px;">
                <label for="price-band-select-pros" style="font-weight:600;">Faixa de pre칞o:</label>
                <select id="price-band-select-pros" style="padding:6px 8px; border-radius:6px;">
                    <option value="retira">Retira R$</option>
                    <option value="entrega">Entrega R$</option>
                    <option value="km100_199">100 a 199 km</option>
                    <option value="km200_299">200 a 299 km</option>
                    <option value="km300_399">300 a 399 km</option>
                    <option value="km400_499">400 a 499 km</option>
                    <option value="km500_599">500 a 599 km</option>
                    <option value="km600_plus">Acima 600km</option>
                </select>
            </div>
        </div>
    </div>

    <div class="main-container">
        <div class="form-section">
            <div class="card">
                <h2><i class="fas fa-search"></i> Dados do Cliente</h2>
                <form id="prospectForm">
                    <div class="form-group">
                        <label for="cnpj">CNPJ:</label>
                        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
                            <input type="text" id="cnpj" placeholder="00.000.000/0001-00" required style="flex: 1; min-width: 200px;">
                            <button type="button" id="searchCnpj" class="btn btn-secondary">
                                <i class="fas fa-search"></i> Buscar API
                            </button>
                            <button type="button" id="searchClients" class="btn btn-primary" style="background: #28a745;">
                                <i class="fas fa-users"></i> Buscar Clientes
                            </button>
                        </div>
                        <small>Digite o CNPJ ou use "Buscar Clientes" para ver lista de clientes ativos/inativos</small>
                    </div>

                    <!-- Modal para sele칞칚o de clientes -->
                    <div id="clientModal" class="modal" style="display: none;">
                        <div class="modal-content" style="max-width: 800px; max-height: 80vh;">
                            <div class="modal-header">
                                <h2><i class="fas fa-users"></i> Selecionar Cliente</h2>
                                <span class="close" id="closeClientModal">&times;</span>
                            </div>
                            <div style="padding: 20px; overflow-y: auto; max-height: 60vh;">
                                <div style="margin-bottom: 15px;">
                                    <input type="text" id="clientSearch" placeholder="Buscar por nome ou CNPJ..." 
                                           style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                </div>
                                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                                    <button type="button" id="showActiveClients" class="btn btn-success">
                                        <i class="fas fa-check-circle"></i> Ativos
                                    </button>
                                    <button type="button" id="showInactiveClients" class="btn btn-secondary">
                                        <i class="fas fa-pause-circle"></i> Inativos
                                    </button>
                                </div>
                                <div id="clientList" style="max-height: 400px; overflow-y: auto;">
                                    <!-- Lista de clientes ser치 carregada aqui -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="keywords">Palavras-chave do Card치pio:</label>
                        <textarea id="keywords" placeholder="Digite palavras-chave do card치pio separadas por v칤rgula (ex: pizza, hamb칰rguer, refrigerante, a칞a칤, carne, frango)" 
                                  rows="3" style="width: 100%; padding: 0.75rem; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; resize: vertical; font-family: inherit;"></textarea>
                        <small>Digite palavras-chave que descrevem o card치pio do cliente para sugest칫es mais precisas</small>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-magic"></i> Analisar e Criar Prospec칞칚o
                    </button>
                </form>
            </div>

            <div class="loading-section" id="loadingSection" style="display: none;">
                <div class="card">
                    <div class="loading-spinner">
                        <i class="fas fa-spinner fa-spin"></i>
                    </div>
                    <h3>Analisando dados do cliente... </h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                    <div class="loading-steps">
                        <div class="step" id="step1">
                            <i class="fas fa-building"></i> Coletando dados da empresa
                        </div>
                        <div class="step" id="step2">
                            <i class="fas fa-map-marker-alt"></i> Analisando localiza칞칚o
                        </div>
                        <div class="step" id="step3">
                            <i class="fas fa-utensils"></i> Processando card치pio
                        </div>
                        <div class="step" id="step4">
                            <i class="fas fa-chart-line"></i> Sugerindo produtos
                        </div>
                        <div class="step" id="step5">
                            <i class="fas fa-palette"></i> Criando arte personalizada
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="results-section" id="resultsSection" style="display: none;">
            <div class="company-info card">
                <h2><i class="fas fa-building"></i> Informa칞칫es da Empresa</h2>
                <div id="companyDetails"></div>
            </div>

            <div class="menu-analysis card">
                <h2><i class="fas fa-chart-pie"></i> An치lise do Card치pio</h2>
                <div id="menuAnalysis"></div>
            </div>

            <div class="sales-script card">
                <h2><i class="fas fa-microphone"></i> Script de Vendas Personalizado</h2>
                <div id="salesScript"></div>
                <button id="copySalesScript" class="btn btn-secondary">
                    <i class="fas fa-copy"></i> Copiar Script
                </button>
            </div>
            

            <div class="product-suggestions card">
                <h2><i class="fas fa-lightbulb"></i> Produtos Sugeridos (Escolha multiplos de 3 produtos para gera칞칚o de imagem)</h2>
                <div id="productSuggestions"></div>
                <button id="createOffer" class="btn btn-success">
                    <i class="fas fa-palette"></i> Criar Arte da Oferta
                </button>
            </div>

            
        </div>
    </div>

    <!-- Modal para Arte da Oferta -->
<div id="offerModal" class="offer-customized card" style="display: none;">
    <div class="modal-header">
        <h2><i class="fas fa-palette"></i> Arte da Oferta Personalizada</h2>
        <span class="close-btn" id="closeModal">&times;</span>
    </div>
    <div class="offer-customized-content">
        <div class="offer-preview" id="offerPreview">
            <!-- Arte ser치 gerada aqui -->
            <p>PMG 30 Anos</p>
            <h3>Oferta Especial<br>Personalizada para <span id="clientName">REAL PARMA</span></h3>
            <div class="offer-products" id="dynamicOfferProducts">
                <!-- Produtos escolhidos pelo usu치rio ser칚o inseridos aqui dinamicamente -->
            </div>
        </div>
    </div>
    <div class="modal-buttons" style="margin-top: 20px; text-align: center;">
    <button id="copyOfferImage" class="btn-primary" style="margin-right: 10px; background: #007bff; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        游늶 Copiar Imagem
    </button>
    <button id="copyOfferText" class="btn-secondary" style="background: #6c757d; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer;">
        游늯 Copiar Texto
    </button>
</div>
</div>

    <script src="prospeccao.js?v=2.4.0.0"></script>
    <script src="social-media-analyzer.js?v=2.4.0.0"></script>
    <script>
        // Sincroniza valor inicial do seletor com localStorage, caso o JS principal demore
        (function(){
            try {
                var band = localStorage.getItem('priceBand') || 'retira';
                var sel = document.getElementById('price-band-select-pros');
                if (sel) sel.value = band;
            } catch(e) {}
        })();
    </script>
</body>
</html>
